<%- include('./partials/header.ejs') %>

    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>


    <!-- Humberger Begin -->
    <div class="humberger__menu__overlay"></div>
    <div class="humberger__menu__wrapper">
        <div class="humberger__menu__logo">
            <a class="navbar-brand text-dark fs-4 fw-bold" href="#">FRESH<span class="text-danger">org</span></a>
        </div>
        <div class="humberger__menu__cart">
            
            <div class="header__top__right__auth">
                <% if(!id) {%>

                    <div class="header__top__right__auth">
                        <a onclick="login()"><i class="fa fa-user"></i> Login</a>
                    </div>

                    <% } else {%>
                    

                    <ul>
                        <li id="wishlist"><a href="/wishlist"><i class="fa fa-heart"></i> <span><% if(wishlist){ %><%= wishlist.items.length %><% }else{ %>0<% } %></span></a></li>
                        <li><a href="/cart"><i class="fa fa-shopping-bag"></i> <span><% if(cart){ %><%= cart.items.length %><% }else{ %>0<% } %></span></a></li> 
                    </ul>

                    <div class="header__top__right__auth">
                        <a href="/profile"><i class="fa fa-user"></i><%= user.username %></a>
                    </div>

                    <div class="header__top__right__auth">
                        <a href="/logout" style="box-shadow: none;border: none;" class="btn btn-sm btn-outline-danger">Logout</a>
                    </div>
                    
                    <% } %>
            </div>

        </div>

        <nav class="humberger__menu__nav mobile-menu">
            <ul>
                <li class="active"><a href="/">Home</a></li>
                <li><a href="/shop">Shop</a></li>
                <!-- <li><a href="#">About</a></li>
                <li><a href="#">Contact</a></li> -->
            </ul>
        </nav>
        <div id="mobile-menu-wrap"></div>

    </div>
    <!-- Humberger End -->

    <!-- Header Section Begin -->
    <header class="header">

        <div class="container">
            <div class="row">
                <div class="col-lg-3">
                    <div class="header__logo">
                        <a class="navbar-brand text-dark fs-4 fw-bold" href="#">FRESH<span
                                class="text-danger">org</span></a>
                    </div>
                </div>
                <div class="col-lg-6">
                    <nav class="header__menu">
                        <ul>
                            <li class="active"><a href="/">Home</a></li>
                            <li><a href="/shop">Shop</a></li>
                            <!-- <li><a href="#">About</a></li>
                            <li><a href="#">Contact</a></li> -->
                        </ul>
                    </nav>
                </div>
                <div class="col-lg-3">
                    <div class="header__cart header__menu">

                        <div class="header__top__right__auth">

                            <% if(!id) {%>
                            
                            

							<div class="header__top__right__auth">
                                <a href="/login"><i class="fa fa-user"></i> Login</a>
                            </div>

                            <% } else {%>
                            

                            <ul>
                                <li id="wishlist"><a href="/wishlist"><i class="fa fa-heart"></i> <span><% if(wishlist){ %><%= wishlist.items.length %><% }else{ %>0<% } %></span></a></li>
                                <li><a href="/cart"><i class="fa fa-shopping-bag"></i> <span><% if(cart){ %><%= cart.items.length %><% }else{ %>0<% } %></span></a></li>
                            </ul>

                            <div class="header__top__right__auth">
                                <a href="/profile"><i class="fa fa-user"></i><%= user.username %></a>
                            </div>

							<div class="header__top__right__auth">
                                <a href="/logout" style="box-shadow: none;border: none;" class="btn btn-sm btn-outline-danger">Logout</a>
                            </div>
                            
                            <% } %>
                        </div>

                    </div>
                </div>
            </div>

        </div>
        <div class="humberger__open">
            <i class="fa fa-bars"></i>
        </div>
        </div>
    </header>
    <!-- Header Section End -->

    <div class="container-fluid">
        <div class="row m-0 h-100">
            <div class="col mt-4">
                <div>
                    <div class="row h-50 align-items-center">
                        <div class="col">
                            <div class="row h-75">
                                <div class="col">
                                    <div class="row justify-content-center">
                                        <div class="col-6 d-flex justify-content-center">
                                            <div style="height: 8rem;width: 8rem;border: .05rem solid rgb(174, 171, 171);"
                                                class=" rounded-circle d-flex align-items-center justify-content-center">
                                                <i class="fa fa-user" style="font-size: 2.5rem;"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row justify-content-center">
                                        <div class="col-6 d-flex flex-column align-items-center">
                                            <div class="row">
                                                <%= user.username %>
                                            </div>
                                            <div style="font-size: .75rem;" class="row"><%=user.createdAt.toLocaleDateString('en-US', { month: 'long' ,
                                                day: 'numeric' , year: 'numeric' ,});%></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row justify-content-center mt-4">
                        <div class="col-6 d-flex flex-column">
                            <div style="border: .05rem solid rgb(174, 171, 171);min-height: 2rem">
                                <a href="/profile" class="nav-link text-dark">Profile</a>
                            </div>
                            <div style="border: .05rem solid rgb(174, 171, 171);background-color: #7FAD39;min-height: 2rem"><a href="/order"
                                    class="nav-link text-light">Orders</a></div>
                            <div
                                style="border: .05rem solid rgb(174, 171, 171);min-height: 2rem">
                                <a href="/address" class="nav-link text-dark">Address</a></div>
                            <div style="border: .05rem solid rgb(174, 171, 171);min-height: 2rem">
                                <a href="/wallet" class="nav-link text-dark">Wallet</a>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            
            <div class="col-md-7  mt-4">
                <% if(orders !== null){ %>
                    <% for(let i=0;i<orders.length;i++){  %>
                    <div class="row mb-3">
                        <div class="col-md-12 col-sm-12">
                            <div  class="card text-center" id="<%= orders[i]._id %>">
                                <div class="card-body d-flex justify-content-between">
                                    <div class="d-flex flex-column">
                                        <div class="d-flex flex-column align-items-start" style="font-size: .80rem;">
                                            <div>Order Id: <span class="font-weight-bold"><%= orders[i]._id.toString().substring(0, 6) %></span></div>
                                            <div>Order Date: <span class="font-weight-bold"><%=orders[i].order_date.toLocaleDateString('en-US', { 
                                                month: 'long', 
                                                day: 'numeric',
                                                year: 'numeric',});%></span></div>
                                            <div>Status: <span class="font-weight-bold <% if(orders[i].order_status=='pending') {%> text-warning <% }else if(orders[i].order_status=='rejected' || orders[i].order_status=='cancelled') {%> text-danger <% }else{ %> text-secondary <% } %>"><%= orders[i].order_status %></span></div>
                                        </div>
                                    </div>
                                    <div class="d-flex flex-column align-items-center justify-content-center">
                                        <div style="font-size: .90rem;" class="<% if(orders.order_status=='pending') {%> text-warning <% }else if(orders.order_status=='rejected') {%> text-danger <% }else{ %> text-secondary <% } %>"><%= orders.order_status %></div>
                                        <kbd onclick="loadOrderDetails('<%= orders[i]._id %>')"  class="btn-dark mt-2 ">view</kbd>
                                        <% if(orders[i].order_status == "pending"){ %>
                                        <kbd onclick="removeOrder('<%= orders[i]._id %>')"  class="btn-danger mt-2 hai">cancel</kbd>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <% } %>
                    <% } else {%>
                        <div class="h-100 d-flex justify-content-center align-items-center">
                            <div class="h1 text-danger">There Is No Orders</div>
                        </div>
                    <% } %>

                </div>
            </div>
        </div>
        

    </div>
    </div>
    </div>

    <!-- ajax -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

    <!-- sweet alert cdn -->
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        function deleteAddress(id) {
          Swal.fire({
            icon: "warning",
            title: "Are you sure?",
            text: "Delete Address?",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "remove",
          }).then((result) => {
            if (result.isConfirmed) {
              axios.delete(`/address/delete?id=${id}`).then((result) => {
                Swal.fire("removed!", "Address has been deleted.", "success").then((response) => {
                  location.reload();
                })
              })
              
            }
          });
        }

        function removeOrder(orderId){

            Swal.fire({
            icon: "warning",
            title: "Cancel Order?",
            text: "Are you sure?",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Yes",
            cancelButtonText: "Back",
            }).then((result)=>{
                if(result.isConfirmed){
                    $.ajax({
                        type: "POST",
                        url: "/order/cancel",
                        data: {
                            orderId: orderId,
                        },
                        success: function(res){
                            if(res.response){
                                $.get(location.herf, function(data){
                                    $(`#${orderId}`).html($(data).find(`#${orderId}`).html());
                                });
                            }
                        }
                    })
                }
            })
            
            
            
        }


        function loadOrderDetails(orderId){

            location.href = `/order/details?orderId=${orderId}`

        }

      </script>

    <%- include('./partials/footer.ejs') %>